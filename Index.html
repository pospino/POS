<!DOCTYPE html>
<html>
<head>
    <title>Page Title</title>

    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
    <script src="http://maps.google.com/maps/api/js?sensor=true&key=AIzaSyBTnpZ8wO0idZWWhR2hSnDAvGNaoXR5xcs" type="text/javascript"></script>
    <style>
        #map-page, #map-canvas {
            width: 100%;
            height: 100%;
            padding: 0;
        }


        .infoDiv {
            height: 100px;
            width: 100px;
            -webkit-user-select: none;
            background-color: white;
        }
    </style>
</head>

<body>
    <div data-role="page" id="map-page">
        <div data-role="header">
            <a href="#ADD" data-role="button" data-inline="true" data-rel="dialog" data-transition="pop" data-icon="plus">Agregar POS</a>

            <h1>Diabetrics - POS</h1>
            <a href="javascript:Actualizar()" data-icon="refresh">Actualizar</a>

        </div>
        <div data-role="content" id="map-canvas">
          
        </div>
    </div>
    <div style=" z-index: 0; position: absolute;  top: 50px;width:100%; text-align:center;">
         <input type="text" id="hola" style="width:80%"  placeholder="Direccion"  />
        </div>
    <div data-role="page" id="ADD" data-theme="a" class="ui-corner-all" style="height:80%">
        <form>
            <div style="padding: 10px 20px;">
                <h3>Datos del Punto de Venta</h3>

                <div data-role="fieldcontain">
                    <label for="PS_GroupID">Grupo:</label>
                    <input type="text" name="PS_GroupID" id="PS_GroupID" value="">
                </div>

                <div data-role="fieldcontain">
                    <label for="PS_Name">Nombre:</label>
                    <input type="text" name="PS_Name" id="PS_Name" value="">
                </div>
                
               <div data-role="fieldcontain">
                    <label for="PS_Direccion">Dirección:</label>
                    <input type="text" name="PS_Direccion" id="PS_Direccion" value="">
                </div>

                <button type="submit" data-theme="b" data-icon="check">Guardar</button>
                                <button type="reset" data-theme="b" data-icon="check">Cancelar</button>

            </div>
        </form>
    </div>
    <script>



        function Actualizar() {
            window.location = "Index.html";
        }
        function AddPinMark(map, lat, lng, texto, direccion, isMe) {
            var myLatlng = new google.maps.LatLng(lat, lng);
            var marker = new google.maps.Marker({
                position: myLatlng,
                map: map,
                title: texto
            });
            google.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });

            var infowindow = new google.maps.InfoWindow({
                content: "<div class='infoDiv'><h4>" + texto + "</h4><h6>" + direccion + "</h6></div>"
            });



            if (isMe)
                marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');
            else
                marker.setIcon('pin.png');
        }
        $(document).ready(function () {
            $.mobile.allowCrossDomainPages = true;
            $.support.cors = true;

            navigator.geolocation.getCurrentPosition(
                function (position) {
                    var cerca = new Object;
                    cerca.lat = position.coords.latitude;
                    cerca.lng = position.coords.longitude;
                    google.maps.visualRefresh = true;
                    var mapOptions = {
                        zoom: 14,
                        center: new google.maps.LatLng(cerca.lat, cerca.lng),
                        mapTypeId: google.maps.MapTypeId.G_NORMAL_MAP
                    };
                    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);


                    AddPinMark(map, cerca.lat, cerca.lng, "Yo estoy Aquí", "", true);

                    $.ajax({
                        url: "http://track.diabetrics.co/home/Mobile?callback=?",
                        dataType: 'jsonp',
                        success: function (data, status, jqXHR) {
                            // alert(data.length);
                            for (var i = 0; i < data.length; i++) {
                                var dato = data[i];
                                AddPinMark(map, dato.PS_Latitude, dato.PS_Longitude, dato.PS_Name, dato.PS_Direccion, false);

                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log(jqXHR); console.log(textStatus); console.log(errorThrown);
                        }
                    });
                    google.maps.event.addDomListener(window, 'resize', function () {
                        var center = map.getCenter();
                        google.maps.event.trigger(map, "resize");
                        map.setCenter(center);
                    });

                },
                function (error) {
                    switch (error.code) {
                        case error.PERMISSION_DENIED: alert("user did not share geolocation data");
                            break;
                        case error.POSITION_UNAVAILABLE: alert("could not detect current position");
                            break;
                        case error.TIMEOUT: alert("retrieving position timed out");
                            break;
                        default: alert("unknown error");
                            break;
                    }
                });
        });

        $(document).bind("mobileinit", function () {
            $.support.cors = true;
            $.mobile.allowCrossDomainPages = true;
        });
    </script>
</body>
</html>
